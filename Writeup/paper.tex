\documentclass{sig-alternate-05-2015}

\usepackage{graphicx}

\def\sharedaffiliation{%
\end{tabular}
\begin{tabular}{c}}

\begin{document}
	
	% Copyright
	\setcopyright{acmcopyright}
	%\setcopyright{acmlicensed}
	%\setcopyright{rightsretained}
	%\setcopyright{usgov}
	%\setcopyright{usgovmixed}
	%\setcopyright{cagov}
	%\setcopyright{cagovmixed}
	
	
	% DOI
	\doi{n/a}
	
	% ISBN
	\isbn{n/a}

\date{\today}
\title{\ttlfnt{Comparing the performance of websites and their content distribution networks}}
\author{
	\begin{tabular}{c}
		% 1st. author
		Jacques Heunis \\
		\affaddr{University of Cape Town}\\
		\email{hnsjac003@myuct.ac.za}
	\end{tabular}%
	\begin{tabular}{c}
		% 2nd. author
		Brian McGeorge \\
		\affaddr{University of Cape Town}\\
		\email{mcgbri004@myuct.ac.za}
	\end{tabular} 
}

\maketitle

\begin{abstract}
\end{abstract}

\section{Introduction}\label{sec:intro}
In the modern internet, 65\% of web traffic is handled by just 10 organisations \cite{Gehlen2012}. These organisations have to serve tremendous amounts of data to a large user base across the globe. Vast Content Delivery Networks (CDN) and data centres are therefore required to serve up all this content. Approximately 90\% of Google's traffic and over 50\% of Level3 and Limelight's traffic is from video content alone \cite{Gehlen2012}. Labovitz \textit{et al.} \cite{Labovitz:2010:IIT:2043164.1851194} suggests that videos account for $25-40\%$ of all HTTP traffic. 

Of the video streaming services on the internet, YouTube is most popular with over a billion users \cite{youtubeStats}. Everyday, YouTube generates billions of views with people watching hundreds of million of hours of content \cite{youtubeStats}. With new content constantly getting generated around the world, caching strategies are required so that this content can be served up at a high throughput from as close as possible to the user. ISPs play a critical role in this through their peering policies and by providing their own CDNs for various content \cite{Labovitz:2010:IIT:2043164.1851194}.

Our aim in this paper is to investigate the performance of the CDN's that serve this content. We will examine different streaming services across a variety of South African Internet Service Providers (ISP) to examine how traffic is routed and where it comes from. In addition, we will also examine the caching behaviour of YouTube, which has local caches in South Africa. We have developed a tool which automates many of the aforementioned measurements. It can take a list of URLs to content on a streaming service and record various performance metrics regarding how the content is delivered to the end-user.

Section \ref{sec:related} will examine related work in measuring the performance of streaming services and studies which investigate the behaviour of CDNs for multimedia streaming services. Section \ref{sec:method} describes the tool that we developed and details the steps we followed in using it to capture our results. Section \ref{sec:results} presents the results and a discussion thereof.



\section{Related Work}\label{sec:related}
% Relevant work that has been done
Uncovering the Big Players of the Web\\
Dissecting Video Server Selection Strategies
in the YouTube CDN\\
YouTube traffic dynamics and its interplay with a tier-1 ISP: an ISP perspective\\
When YouTube Does not Work - Analysis of QoE-Relevant Degradation in Google CDN Traffic\\
Internet Inter-Domain Traffic\\
YouTube Traffic Characterization: A View From the Edge\\


% TODOs:
% 	- add a section on the tool, what it does and how it tries to ensure accuracy and repeatability in our dynamic environment (throughput and ping tests beforehand, repeating each run 3 times, re-try logic to make the code robust etc. etc. Just sell it!)
% 	- (Sub?)Section on the data we collect and why this information is useful for our study
\section{Method}\label{sec:method}
\subsection{Measurement and tools}
% Possible improvements / modifications:
% "owner of the web page" -> organisation hosting the webpage?
% Why 3000 packets?
% We also do a ping test at the start to ensure that latency is in a reasonable range (< 150 ms)
%
%

To measure the performance of CDNs, we have created a tool to automatically capture various quantitative and qualitative performance metrics when given a list of URLs to online video or audio content. In order to compare the performance of CDNs to that of the websites that present the content, we measure 2 primary quantitative metrics: Ping or Round-trip-time and the number of hops required to reach the server. We also measure the throughput to the CDN. To gain further insight into the potential causes for variances in performance, we also take note of the location and owner of the web page and CDN IPs.

Our tool is written using Python 3, but makes use of a number of third-party tools and services. It makes use of the youtube-dl\footnote{youtube-dl: available at https://rg3.github.io/youtube-dl/} tool to download multimedia content (which is used to measure bandwidth, as detailed below), and uses tcpdump to passively capture network traffic (on Windows we use WinDump which is a Windows port of tcpdump, but for the purposes of this report we will refer to tcpdump). The ipinfo.io service\footnote{ipinfo: available at http://ipinfo.io/} is used to gather information about the registered owners of the website and CDN IP addresses.

For each input URL we run youtube-dl and ask that it simply return the URL of the actual content and exit. Both URLs are resolved to IP addresses and stored for later measurement. We then run tcpdump, specifying that it will terminate after 3000 packets have been received, and then run youtube-dl again. This time we let youtube-dl actually download the media file, allowing tcpdump to capture the required 3000 packets and then terminate. At this point we can kill the youtube-dl process and just consider its output. First, we look at the last line of output from youtube-dl in order to get the throughput that the content was transmitted at. This does mean that we rely on youtube-dl's measurements being accurate, but previous attempts to measure throughput ourselves proved inaccurate as youtube-dl does some work before downloading (for example to get the CDN URL from the webpage).

Next we go through every packet that tcpdump captured and find the IP that sent us the most packets. We consider that to be the IP that the content actually came from, as long as more than one third of the captured packets came from that IP. In the event that no single IP was the source of more than one third of the captured packets, we retry up to three times. This retry behaviour gives our test greater stability in the face of existing network traffic. Now we have an IP for the website, the CDN, and the actual content, and we run ping and traceroute, as well as querying ipinfo.io for all three of these.

In order to reduce the chance of our results being affected by other applications that might be using the network, we first listen to the existing traffic on the network when the tool first starts up. If there is more than 100KB/s of incoming traffic or more than 30KB/s of outgoing traffic, we prompt the user to reduce network traffic and do not proceed with the test. This gives our results greater accuracy and repeatability as it prevents us from running the experiment when there is already high-network usage, which would skew the data.

In order to further improve the accuracy of our results, we run each test 3 times for each input URL. This prevents a short-running network-intensive process from executing only during one test and leading us to believe that one particular website or piece of content is received significantly more slowly than the others.

\subsection{Sources of multimedia content}
As mentioned in Section \ref{sec:intro}, Youtube is one of the most popular video streaming services on the internet. Since this is not a study of Youtube specifically, we need to gather data on a number of other multimedia streaming services as well. We decided to also gather data about the popular music sharing service Soundcloud, as well as the popular live video streaming platform Twitch.tv. Note that our analysis is restricted to on-demand multimedia streaming and we do not consider the performance of live streaming services on Youtube or Twitch.tv. Note also that we did not include Netflix in our evaluation. While Netflix does constitute a large portion of internet video streaming traffic in the US, it is far less popular in South Africa and so its performance is of less importance here.

Of particular interest is the effect of caching on the performance of Youtube videos. It is widely known that there are Google caches in South Africa and that local ISPs have their own caches. For this reason we specifically included performance evaluations for Youtube videos that are unpopular or have very few views. To find such videos, we manually looked through the ``unknownvideos'' section of Reddit\footnote{``/r/unknownvideos - Watch something new'', available at https://www.reddit.com/r/unknownvideos}.

\subsection{Measurement Location}
We measure two different scenarios: Home networks and Institutional networks. In the case of home networks, all our measurements were done from the same location (in order to ensure consistency in our results). Home network measurements were taken while connected to five different ISPs (namely Afrihost, Axxess, Cybersmart, Telkom, and WebAfrica) for comparison.

In the case of institutional networks, all our measurements were done while connected to the UCT network. This test was added in order to compare the results from a home network to what one might get on a network with significantly higher bandwidth.

\section{Results}\label{sec:results}
\subsection{Home network}
% We are missing the caching train in this section wrt unpopular video (since the same video is used)
% Telkom is first -> EU Google Cache -> Telkom -> Telkom
% Then ISP 2 is second -> SA Google Cache -> ISP 2 -> ISP 2
% Then ISP 3 is third -> SA Google Cache -> ISP 3 -> ISP 3
% Then ISP 4 is fourth but uses same backbone as ISP 3 so -> ISP 3 -> ISP 3 -> ISP 3 etc.

We ran our tests on a single home network, gathering measurements for 5 different ISPs (namely Afrihost, Axxess, Cybersmart, Telkom, and WebAfrica) using the same four media URLs\footnote{Unpopular Youtube video: \\ https://www.youtube.com/watch?v=1-xX7hPxMio}\footnote{Popular Youtube video: \\ https://www.youtube.com/watch?v=9bZkp7q19f0}\footnote{Soundcloud audio: \\ https://soundcloud.com/nocopyrightsounds/lensko-cetus-ncs-release}\footnote{Twitch.tv video: \\https://www.twitch.tv/dota2ti/v/83400929}.
Below are the results of each run, averaged across ISPs:
\vspace{1em} \\
Ping: \\
\begin{tabular}{|l|l|c|c|c|} \hline
Run & Source & Website & CDN & Content \\ \hline
1 & Unpopular Youtube & 39  & 35  & 56  \\ \hline
  & Popular Youtube   & 60  & 14  & 14  \\ \hline
  & Soundcloud        & 161 & 162 & 184 \\ \hline
  & Twitch.tv         & 198 & 159 & 172 \\ \hline
2 & Unpopular Youtube & 45  & 14  & 17  \\ \hline
  & Popular Youtube   & 63  & 14  & 31  \\ \hline
  & Soundcloud        & 161 & 160 & 165 \\ \hline
  & Twitch.tv         & 193 & 159 & 181 \\ \hline
3 & Unpopular Youtube & 31  & 17  & 14  \\ \hline
  & Popular Youtube   & 31  & 23  & 18  \\ \hline
  & Soundcloud        & 179 & 171 & 160 \\ \hline
  & Twitch.tv         & 184 & 159 & 161 \\ \hline
\end{tabular}
\vspace{1em} \\
Number of hops: \\
\begin{tabular}{|l|l|c|c|c|} \hline
Run & Source & Website & CDN & Content \\ \hline
1 & Unpopular Youtube & 10 & 7  & 10 \\ \hline
  & Popular Youtube   & 10 & 8  & 8  \\ \hline
  & Soundcloud        & 13 & 18 & 18 \\ \hline
  & Twitch.tv         & 14 & 14 & 15 \\ \hline
2 & Unpopular Youtube & 10 & 7  & 7  \\ \hline
  & Popular Youtube   & 10 & 8  & 8  \\ \hline
  & Soundcloud        & 13 & 18 & 18 \\ \hline
  & Twitch.tv         & 13 & 15 & 12 \\ \hline
3 & Unpopular Youtube & 10 & 7  & 7  \\ \hline
  & Popular Youtube   & 10 & 8  & 8  \\ \hline
  & Soundcloud        & 13 & 18 & 18 \\ \hline
  & Twitch.tv         & 13 & 15 & 13 \\ \hline
\end{tabular}
\vspace{1em} \\
Throughput (KB/s): \\
\begin{tabular}{|l|l|c|c|c|} \hline
Run & Source & Content \\ \hline
1 & Unpopular Youtube & 197.8 \\ \hline
  & Popular Youtube   & 202.6 \\ \hline
  & Soundcloud        & 197.9 \\ \hline
  & Twitch.tv         & 201.2 \\ \hline
2 & Unpopular Youtube & 201.9 \\ \hline
  & Popular Youtube   & 197.8 \\ \hline
  & Soundcloud        & 201.3 \\ \hline
  & Twitch.tv         & 203.1 \\ \hline
3 & Unpopular Youtube & 202.8 \\ \hline
  & Popular Youtube   & 200.4 \\ \hline
  & Soundcloud        & 203.6 \\ \hline
  & Twitch.tv         & 204.9 \\ \hline
\end{tabular}

TODO: Table of "offset from median" of the metrics for each ISP


\subsection{UCT Network}
For a comparison, we also ran two tests on the UCT network. The test was run from a laptop connected to the UCT network via Ethernet.

Note that some of the throughput data points are missing, this is because we measure throughput as youtube-dl downloads and in those cases the download finished before we could get a good measure.
\subsubsection{Test case 1}
The first test case used the following media URLs:
\begin{itemize}
	\item Unpopular Youtube video: \\ https://www.youtube.com/watch?v=nKETYT-2NY8
	\item Popular Youtube video: \\ https://www.youtube.com/watch?v=9bZkp7q19f0
	\item Soundcloud audio: \\ https://soundcloud.com/nocopyrightsounds/lensko-cetus-ncs-release
	\item Twitch.tv video: \\ https://www.twitch.tv/dota2ti/v/83400929
\end{itemize}
The results are tabulated below:
\vspace{1em} \\
Ping: \\
\begin{tabular}{|l|l|c|c|c|} \hline
Run & Source & Website & CDN & Content \\ \hline
1 & Unpopular Youtube & 18  & 49  & 44  \\ \hline
  & Popular Youtube   & 45  & 19  & 18  \\ \hline
  & Soundcloud        & 179 & 148 & 154 \\ \hline
  & Twitch.tv         & 148 & 155 & 148 \\ \hline
2 & Unpopular Youtube & 21  & 19  & 19  \\ \hline
  & Popular Youtube   & 19  & 26  & 19  \\ \hline
  & Soundcloud        & 148 & 149 & 148 \\ \hline
  & Twitch.tv         & 148 & 148 & 148 \\ \hline
3 & Unpopular Youtube & 3   & 19  & 19  \\ \hline
  & Popular Youtube   & 2   & 45  & 68  \\ \hline
  & Soundcloud        & 148 & 148 & 148 \\ \hline
  & Twitch.tv         & 151 & 154 & 148 \\ \hline
\end{tabular}
\vspace{1em} \\
Number of hops: \\
\begin{tabular}{|l|l|c|c|c|} \hline
Run & Source & Website & CDN & Content \\ \hline
1 & Unpopular Youtube & 9 & 9 & 9 \\ \hline
  & Popular Youtube   & 9 & 9 & 9 \\ \hline
  & Soundcloud        & 9 & 9 & 9 \\ \hline
  & Twitch.tv         & 9 & 9 & 9 \\ \hline
2 & Unpopular Youtube & 9 & 9 & 9 \\ \hline
  & Popular Youtube   & 9 & 9 & 9 \\ \hline
  & Soundcloud        & 9 & 9 & 9 \\ \hline
  & Twitch.tv         & 9 & 9 & 9 \\ \hline
3 & Unpopular Youtube & 9 & 9 & 9 \\ \hline
  & Popular Youtube   & 9 & 9 & 9 \\ \hline
  & Soundcloud        & 9 & 9 & 9 \\ \hline
  & Twitch.tv         & 9 & 9 & 9 \\ \hline
\end{tabular}
\vspace{1em} \\
Throughput: \\
\begin{tabular}{|l|l|c|c|c|} \hline
Run & Source & Content \\ \hline
1 & Unpopular Youtube & 1484.8  \\ \hline
  & Popular Youtube   & 8560.6  \\ \hline
  & Soundcloud        & 1351.7  \\ \hline
  & Twitch.tv         & 11284.5 \\ \hline
2 & Unpopular Youtube & 7690.2  \\ \hline
  & Popular Youtube   & 8161.3  \\ \hline
  & Soundcloud        & -       \\ \hline
  & Twitch.tv         & 11264.0 \\ \hline
3 & Unpopular Youtube & 7598.1  \\ \hline
  & Popular Youtube   & 9543.7  \\ \hline
  & Soundcloud        & -       \\ \hline  
  & Twitch.tv         & 11233.3 \\ \hline
\end{tabular}

\subsubsection{Test case 2}
The second test case used the following media URLs:
\begin{itemize}
	\item Unpopular Youtube video: \\ https://www.youtube.com/watch?v=nKETYT-2NY8
	\item Popular Youtube video: \\ https://www.youtube.com/watch?v=9bZkp7q19f0
	\item Soundcloud audio: \\ https://soundcloud.com/nocopyrightsounds/lensko-cetus-ncs-release
	\item Twitch.tv video: \\ https://www.twitch.tv/dota2ti/v/83400929
\end{itemize}
The results are tabulated below:
\vspace{1em} \\
Ping: \\
\begin{tabular}{|l|l|c|c|c|} \hline
Run & Source & Website & CDN & Content \\ \hline
1 & Unpopular Youtube & 4   & 19  & 188 \\ \hline
  & Popular Youtube   & 4   & 19  & 21  \\ \hline
  & Twitch.tv         & 148 & 154 & 148 \\ \hline
  & Soundcloud        & 148 & 148 & 0   \\ \hline
2 & Unpopular Youtube & 3   & 47  & 19  \\ \hline
  & Popular Youtube   & 4   & 20  & 19  \\ \hline
  & Twitch.tv         & 172 & 154 & 0   \\ \hline
  & Soundcloud        & 148 & 149 & 149 \\ \hline
3 & Unpopular Youtube & 4   & 33  & 19  \\ \hline
  & Popular Youtube   & 3   & 20  & 18  \\ \hline
  & Twitch.tv         & 149 & 148 & 0   \\ \hline
  & Soundcloud        & 148 & 148 & 148 \\ \hline
\end{tabular}
\vspace{1em} \\
Number of hops: \\
\begin{tabular}{|l|l|c|c|c|} \hline
Run & Source & Website & CDN & Content \\ \hline
1 & Unpopular Youtube & 9 & 9 & 9 \\ \hline
  & Popular Youtube   & 9 & 9 & 9 \\ \hline
  & Twitch.tv         & 9 & 9 & 9 \\ \hline
  & Soundcloud        & 9 & 9 & 1 \\ \hline
2 & Unpopular Youtube & 9 & 9 & 9 \\ \hline
  & Popular Youtube   & 9 & 9 & 9 \\ \hline
  & Twitch.tv         & 9 & 9 & 9 \\ \hline
  & Soundcloud        & 9 & 9 & 1 \\ \hline
3 & Unpopular Youtube & 9 & 9 & 9 \\ \hline
  & Popular Youtube   & 9 & 9 & 9 \\ \hline
  & Twitch.tv         & 9 & 9 & 9 \\ \hline
  & Soundcloud        & 9 & 9 & 1 \\ \hline
\end{tabular}
\vspace{1em} \\
Throughput: \\
\begin{tabular}{|l|l|c|c|c|} \hline
Run & Source & Content \\ \hline
1 & Unpopular Youtube & 190.9   \\ \hline
  & Popular Youtube   & 8048.6  \\ \hline
  & Twitch.tv         & 10526.7 \\ \hline
  & Soundcloud        & 1341.4  \\ \hline
2 & Unpopular Youtube & 9513.0  \\ \hline
  & Popular Youtube   & 8335.4  \\ \hline
  & Twitch.tv         & 11397.1 \\ \hline
  & Soundcloud        & -       \\ \hline
3 & Unpopular Youtube & 9840.6  \\ \hline
  & Popular Youtube   & 7260.2  \\ \hline
  & Twitch.tv         & 11274.2 \\ \hline  
  & Soundcloud        & -       \\ \hline
\end{tabular}

\section{Future Work}\label{sec:futurework}
\begin{itemize}
	\item Streaming (e.g incorporate youtube life or twitch non-vods)
	\item Video content vs video adverts
	\item Test from multiple locations
\end{itemize}

\pagebreak

\small
\bibliographystyle{abbrv}
\bibliography{paper}  % sigproc.bib is the name of the Bibliography in this case


\end{document}
